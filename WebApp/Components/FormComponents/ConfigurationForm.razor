@using WebApp.CustomEvents;

<div class="flex flex-col w-full border-l-[#3F79DB] border-l-4">
    <button class="w-full bg-[#D9D9D9] flex flex-row justify-start py-1 px-2 gap-2 items-center" @onclick="StartTransition">
        <i class="fa fa-caret-down transform transition-transform duration-300 ease-in-out @GetCaretRotation()"></i>
        @Title 
        @if(Modified) 
        {
            <span class="text-[#FF0000]"> *</span>
        }
    </button>
    <div class="@GetPanelClasses()" @ontransitionend="() => IsInTransition = false">
        @ChildContent
    </div>
</div>

@code {
    [Parameter]
    public string? Title { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public bool Modified { get; set; }

    protected bool IsOpen { get; set; } = true;

    protected bool IsInTransition { get; set; } = false;

    private string GetCaretRotation() => IsOpen ? "rotate-0" : "-rotate-90";

    public void StartTransition()
    {
        IsOpen = !IsOpen;
        IsInTransition = true;
    }

    private string GetPanelClasses() =>
       "transition-all duration-300 ease-in-out bg-white " +
       (IsOpen ? "max-h-[500px] p-4" : "max-h-0 overflow-hidden p-0");
}
